<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Deliver Feedback</title>
    <link
      rel="stylesheet"
      href="{{ url_for('static',filename='styles/main.css') }}"
      type="text/css"
    />
    <link href="https://fonts.googleapis.com/css2?family=Newsreader:wght@200&display=swap" rel="stylesheet">
    <script src="https://cdn.lordicon.com/libs/frhvbuzj/lord-icon-2.0.2.js"></script>
    <!-- Font Awesome Icon Library -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"
    />
    <style>
      .checked {
        color: orange;
      }
    </style>
    <link rel="stylesheet" href="../css/main.css" type="text/css">
  </head>

  <script>
    function displayStars(numStars) {
      var stars = document.createElement("div");

      for (var x = 0; x < 5; x++) {
        var star = document.createElement("span");

        if (x < numStars) {
          star.className = "fa fa-star checked";
        } else {
          star.className = "fa fa-star";
        }

        stars.appendChild(star);
      }

      return stars;
    }

    function showAll(allScores) {
      var res = document.createTextNode(allScores);
      return res;
    }

    function createTable(tableData, allScores) {
      var table = document.getElementById("thisTable");
      var tablediv = document.getElementById("tablediv");
      var form = document.getElementById("feedbackform");
      var tableBody = document.createElement("tbody");

      tableData.forEach(function (rowData, index) {
        var row = document.createElement("tr");
        for (var i = 0; i < 4; i++) {
          var cellData = rowData[i];
          if (i == 1) {
            switch (cellData) {
              case "Star Rating":
                var cell = document.createElement("td");
                var stars = displayStars(rowData[2]);
                cell.appendChild(stars);

                break;
              case "Text":
                var cell = document.createElement("td");
                cell.appendChild(document.createTextNode(rowData[2]));
            }
          } else if (i == 3) {
            var cell = document.createElement("td");
            cell.appendChild(document.createTextNode(cellData));
          } else if (i == 0) {
            var cell = document.createElement("td");
            cell.appendChild(document.createTextNode(cellData));
          }
          row.appendChild(cell);
        }
        tableBody.appendChild(row);
      });

      table.appendChild(tableBody);

      form.insertBefore(table, form.firstChild);

      tablediv.appendChild(form);
    }
  </script>

  <!-- https://stackoverflow.com/questions/15164655/generate-html-table-from-2d-javascript-array -->
  <!-- https://stackoverflow.com/questions/61472018/how-do-i-convert-pythonflask-list-of-objects-to-js-list-of-objects -->
  <body>
    <div class="box header"><h2>Feedback System</h2></div>
    <br />

    <div class="screenbox" id="tablediv" width="600px" style="height: 450px;">
   
    <br>
      <h3 style="text-align: center;">
          <lord-icon
            src="https://cdn.lordicon.com/tyounuzx.json"
            trigger="loop"
            colors="primary:#121331,secondary:#16ccec"
            style="width:60px;height:60px; text-align: center;">
           </lord-icon>
          <br>
          {{g.room_code}}
        </h3>

      <br />
      <table id="thisTable" name="thisTable" width="350px">
        <caption style="font-weight: 900; color: #16ccec; font-size: 20px;">
          Feedback Form
        </caption>
        <br>
        <tr>
          <th>Question</th>
          <th>Feedback</th>
          <th>Sentiment score</th>
        </tr>
      </table>

      <script>
        var entries = JSON.parse('{{ g.jdump|safe }}');
        var sentScores = JSON.parse('{{ g.compDump|safe }}');
        console.log(entries);
        console.log(sentScores);
        createTable(entries, sentScores);
        //console.log(entries);
      </script>

      <form action="/chart/{{g.room_code}}" class="centrecontent">
        <input
          type="submit"
          value="SEE VISUALISATION"
          class="button"
        />
      </form>
    </div>

    <script
      src="https://unpkg.com/react@17/umd/react.development.js"
      crossorigin
    ></script>
    <script
      src="https://unpkg.com/react-dom@17/umd/react-dom.development.js"
      crossorigin
    ></script>
  </body>
</html>
